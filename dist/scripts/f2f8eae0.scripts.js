"use strict";angular.module("aquiferiumApp",["ngCookies","ngResource","ngSanitize","ngRoute","ngAnimate","angular-carousel","angular-parallax","videosharing-embed","eaa.directives.d3.maps","eaa.directives.d3.interactives"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/explore.html",controller:"ExploreCtrl"}).when("/explore",{templateUrl:"views/explore.html",controller:"ExploreCtrl"}).when("/caves-karsts",{templateUrl:"views/caves-karsts.html",controller:"CavesKarstsCtrl"}).when("/conservation",{templateUrl:"views/conservation.html",controller:"ConservationCtrl"}).when("/springs",{templateUrl:"views/springs.html",controller:"SpringsCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/contact",{templateUrl:"views/contact.html",controller:"ContactCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("aquiferiumApp").controller("NavigationCtrl",["$scope","$location",function(a,b){a.isCollapsed=!0,a.$on("$routeChangeSuccess",function(){a.isCollapsed=!0}),a.logLocation=function(){console.log(b.$$path)},a.getClass=function(a){return"/"===a&&"/"===b.path()?"active":b.path().substr(0,a.length)===a?"active":void 0}}]),angular.module("aquiferiumApp").controller("ExploreCtrl",["$scope",function(a){a.pageClass="explore"}]),angular.module("aquiferiumApp").controller("CavesKarstsCtrl",["$scope","$location","$anchorScroll",function(a,b,c){a.pageClass="caves-karsts",a.resetView=function(){b.hash(".caveskarsts"),c()},a.resetView(),a.goToByScroll=function(a){var b=$("#navbar").innerHeight(),c=angular.element(document).find("body").css("class",".caveskarsts");c.animate({scrollTop:$('.slide[data-slide="'+a+'"]').offset().top-b},2e3,"easeInOutQuint")},a.buttonClick=function(b){b.preventDefault();var c=angular.element(b.target).attr("data-slide");a.goToByScroll(c)}}]),angular.module("aquiferiumApp").controller("ConservationCtrl",["$scope","$location","$anchorScroll",function(a,b,c){a.pageClass="conservation",a.resetView=function(){b.hash(".conservation"),c()},a.resetView(),a.goToByScroll=function(a){var b=$("#navbar").innerHeight(),c=angular.element(document).find("body").css("class",".conservation");c.animate({scrollTop:$('.slide[data-slide="'+a+'"]').offset().top-b},2e3,"easeInOutQuint")},a.buttonClick=function(b){b.preventDefault();var c=angular.element(b.target).attr("data-slide");a.goToByScroll(c)}}]),angular.module("aquiferiumApp").controller("SpringsCtrl",["$window","$scope","$location","$anchorScroll",function(a,b,c,d){b.pageClass="springs",b.hcpurl="http://eahcp.org/index.php/about_eahcp/covered_species",b.linkModelFunc=function(b){a.open(b)},b.resetView=function(){c.hash(".springs"),d()},b.resetView(),b.goToByScroll=function(a){var b=$("#navbar").innerHeight(),c=angular.element(document).find("body").css("class",".springs");c.animate({scrollTop:$('.slide[data-slide="'+a+'"]').offset().top-b},2e3,"easeInOutQuint")},b.buttonClick=function(a){a.preventDefault();var c=angular.element(a.target).attr("data-slide");b.goToByScroll(c)}}]),angular.module("aquiferiumApp").controller("AboutCtrl",["$scope",function(a){a.pageClass="about",a.code="SUhtSnl_ZRM"}]),angular.module("aquiferiumApp").controller("ContactCtrl",["$scope",function(a){a.pageClass="contact"}]),angular.module("eaa.directives.d3.maps",[]).directive("eaaAquifersMap",[function(){var a={compile:!1,controller:function(){},controllerAs:!1,link:!1,priority:0,require:!1,restrict:"E",scope:!1,template:!1,templateUrl:!1,terminal:!1,transclude:!1,type:!1};return a.link=function(a,b){function c(){w=u>1440?[.3*u,.5*v]:u>1200?[.4*u,.5*v]:u>960?[.45*u,.5*v]:u>768?[.42*u,.5*v]:[.5*u,.5*v]}function d(){x=u>1440?5.5:u>1200?5:u>960?4.5:u>768?4:3.5}function e(){var a="#"+("00000"+(Math.random()*(1<<24)|0).toString(16)).slice(-6);return a}function f(a){console.log(a)}var g=window,h=document,i=h.documentElement,j=h.getElementsByTagName("body")[0],k=g.innerWidth||i.clientWidth||j.clientWidth,l=g.innerHeight||i.clientHeight||j.clientHeight,m=.9,n=.6,o=k*m,p=l*n,q="./data/geojson/NEW_major_aquifers_dd_reduced100.geo.json",r="./data/geojson/eaa_boundary_EPSG-3081.geo.json",s="./data/eaaAquiferium-allSprings-markerData.csv",t={top:10,right:10,bottom:10,left:10},u=o-t.left-t.right,v=p-t.top-t.bottom,w=[.5*u,.5*v],x=3.8;c(),d();var y=5,z=b[0],A=d3.select(z).append("div").attr("class","map"),B=A.append("svg").attr("class","mapSvg").attr("width",.92*u).attr("height",v),C=B.append("g").attr("class","texas"),D=B.append("g").attr("class","boundaries");d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},d3.selection.prototype.moveToBack=function(){return this.each(function(){var a=this.parentNode.firstChild;a&&this.parentNode.insertBefore(this,a)})},d3.json(q,function(a,b){if(a)return console.error(a);var c=d3.geo.centroid(b),d=d3.geo.mercator().scale(x).center(c).translate(w),g=d3.geo.path().projection(d),h=C.selectAll("g").data(b.features).enter().append("g");h.append("path").attr("d",g).attr("class","area").attr("fill","#71B2C9").attr("stroke","#4298B5"),d3.json(r,function(a,b){if(a)return console.error(a);var c=D.selectAll("g").data(b.features).enter().append("g");c.append("path").attr("d",g).attr("class","area").attr("fill","#8F8100").attr("stroke","#000");var h=c.append("g");d3.csv(s,function(a,b){return a?console.error(a):void h.selectAll("circle").data(b).enter().append("circle").attr("cx",function(a){return d([a.lon_ddd,a.lat_ddd])[0]}).attr("cy",function(a){return d([a.lon_ddd,a.lat_ddd])[1]}).attr("r",y).attr("z-index",0).style("fill",function(){return e()}).style("stroke","#000").on("click",f)})})})},a}]),angular.module("eaa.directives.d3.interactives",[]).directive("eaaGaugeDataInteractiveSprings",[function(){var a={compile:!1,controller:function(){},controllerAs:!1,link:!1,priority:0,require:!1,restrict:"E",scope:!1,template:!1,templateUrl:!1,terminal:!1,transclude:!1,type:!1};return a.link=function(a,b){function c(a){console.log("over gauge: ",a.name),this.parentNode.parentNode.appendChild(this.parentNode),d3.select(this).style("stroke-width","6px")}function d(a){console.log("out gauge: ",a.name),d3.select(this).style("stroke-width","2px")}function e(a){console.log(d3.select(a)[0][0].Location)}var f=window,g=document,h=g.documentElement,i=g.getElementsByTagName("body")[0],j=f.innerWidth||h.clientWidth||i.clientWidth,k=f.innerHeight||h.clientHeight||i.clientHeight,l=j,m=k,n="./data/geojson/eaa_boundary_EPSG-3081.geo.json",o="./data/eaaAquiferium-allSprings-markerData.csv",p="./data/eaaAquiferium-allSpringsData-annualAvg-byDate.csv",q={top:20,right:0,bottom:20,left:0},r=l-q.left-q.right,s=m-q.top-q.bottom,t=.9*r,u=.4*s,v=.9*r,w=.5*s,x=5,y=d3.scale.category10().domain(["Barton Springs","Comal Springs","Hueco Springs","J17","J27","Las Moras Springs","Leona Springs","San Antonio Springs","San Marcos Springs","San Pedro Springs"]),z=d3.scale.ordinal(),A=d3.time.format("%Y"),B=d3.time.scale().range([0,v-20]),C=d3.scale.linear().range([w-20,0]),D=d3.svg.axis().scale(B).orient("bottom").ticks(20),E=d3.svg.axis().scale(C).orient("left").ticks(20),F=b[0],G=d3.select(F).append("div").attr("class","viz").attr("width",r).attr("height",s),H=G.append("div").attr("class","map"),I=H.append("svg").attr("class","mapSvg").attr("width",t).attr("height",u),J=I.append("g").attr("class","eaabounds");J.attr("transform","translate(0,20)");var K=G.append("div").attr("class","chart"),L=K.append("svg").attr("class","chartSvg").attr("width",v).attr("height",w),M=L.append("g").attr("class","graphbounds");M.attr("transform","translate(0,0)");var N=d3.svg.line().interpolate("monotone").x(function(a){return B(a.date)}).y(function(a){return C(a.gindex)}).defined(function(a){return a.gindex});d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},d3.selection.prototype.moveToBack=function(){return this.each(function(){var a=this.parentNode.firstChild;a&&this.parentNode.insertBefore(this,a)})},d3.json(n,function(a,b){if(a)return console.error(a);var c=28*u,d=[t/2,u/2],f=d3.geo.centroid(b),g=d3.geo.mercator().scale(c).center(f).translate(d),h=d3.geo.path().projection(g),i=J.selectAll("g").data(b.features).enter().append("g");i.append("path").attr("d",h).attr("class","area").attr("fill","#8F8100").attr("stroke","#000");var j=i.append("g");d3.csv(o,function(a,b){return a?console.error(a):void j.selectAll("circle").data(b).enter().append("circle").attr("class",function(a){return a.Location}).attr("cx",function(a){return g([a.lon_ddd,a.lat_ddd])[0]}).attr("cy",function(a){return g([a.lon_ddd,a.lat_ddd])[1]}).attr("r",x).attr("z-index",0).style("fill",function(a){return y(a.Location)}).style("stroke","#000").on("click",e)})}),d3.csv(p,function(a,b){b.forEach(function(a){a.Date=A.parse(a.Date),a["Barton Springs"]=+a["Barton Springs"],a["Comal Springs"]=+a["Comal Springs"],a["Hueco Springs"]=+a["Hueco Springs"],a.J17=+a.J17,a.J27=+a.J27,a["Las Moras Springs"]=+a["Las Moras Springs"],a["Leona Springs"]=+a["Leona Springs"],a["San Antonio Springs"]=+a["San Antonio Springs"],a["San Marcos Springs"]=+a["San Marcos Springs"],a["San Pedro Springs"]=+a["San Pedro Springs"]}),z.domain(d3.keys(b[0]).filter(function(a){return"Date"!==a}));var e=z.domain().map(function(a){return{name:a,values:b.map(function(b){return{date:b.Date,gindex:+b[a]}})}});B.domain(d3.extent(b,function(a){return a.Date})),C.domain([d3.min(e,function(a){return d3.min(a.values,function(a){return a.gindex})}),d3.max(e,function(a){return d3.max(a.values,function(a){return a.gindex})})]),M.append("g").attr("class","x axis").attr("transform","translate(0,"+(w-20)+")").call(D),M.append("g").attr("class","y axis").call(E).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("gauge level in cfs");var f=M.selectAll(".gauge").data(e).enter().append("g").attr("class",function(a){return a.name});f.append("path").attr("class","line").attr("d",function(a){return N(a.values)}).style("stroke",function(a){return y(a.name)}).on("mouseover",c).on("mouseout",d).attr("id",function(a){return a.name});var g=f.filter(function(){}).selectAll("circle").data(function(a){return a.values}).enter().append("circle").attr({cx:function(a){return B(a.date)},cy:function(a){return C(a.gindex)},r:2}).style("fill","#555");g.on("mouseover",function(a){console.log(a),g.append("text").attr({x:function(a){return B(a.date)},y:function(a){return C(a.gindex)},dx:-3,dy:".35em","text-anchor":"end"}).style("fill","black").text(function(a){var b=d3.time.format("%d-%B-%Y");return"Date:"+b(a.date)+",index:"+a.gindex})}).on("mouseout",function(a){console.log("mouse out: ",a),d3.select(this.parentElement).selectAll("text").remove()});var h=M.selectAll(".svg").data(e).enter().append("g").attr("class","legend").attr("transform","translate(-240,0)");h.append("rect").attr("x",r+20).attr("y",function(a,b){return 20*b}).attr("width",10).attr("height",10).style("fill",function(a){return y(a.name)}),h.append("text").attr("x",r+34).attr("y",function(a,b){return 20*b+9}).text(function(a){return a.name}).attr("color","#000").attr("class",function(a){return a.name})})},a}]);