"use strict";angular.module("aquiferiumApp",["ngCookies","ngResource","ngSanitize","ngRoute","ngAnimate","angular-carousel","angular-parallax","videosharing-embed","app.directives.d3.maps","app.directives.d3.interactives"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/explore.html",controller:"ExploreCtrl"}).when("/explore",{templateUrl:"views/explore.html",controller:"ExploreCtrl"}).when("/caves-karsts",{templateUrl:"views/caves-karsts.html",controller:"CavesKarstsCtrl"}).when("/conservation",{templateUrl:"views/conservation.html",controller:"ConservationCtrl"}).when("/springs",{templateUrl:"views/springs.html",controller:"SpringsCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/contact",{templateUrl:"views/contact.html",controller:"ContactCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("aquiferiumApp").controller("NavigationCtrl",["$scope","$location",function(a,b){a.isCollapsed=!0,a.$on("$routeChangeSuccess",function(){a.isCollapsed=!0}),a.logLocation=function(){console.log(b.$$path)},a.getClass=function(a){return"/"===a&&"/"===b.path()?"active":b.path().substr(0,a.length)===a?"active":void 0}}]),angular.module("aquiferiumApp").controller("ExploreCtrl",["$scope",function(a){a.pageClass="explore"}]),angular.module("aquiferiumApp").controller("CavesKarstsCtrl",["$scope","$location","$anchorScroll",function(a,b,c){a.pageClass="caves-karsts",a.resetView=function(){b.hash(".caveskarsts"),c()},a.resetView(),a.goToByScroll=function(a){var b=$("#navbar").innerHeight(),c=angular.element(document).find("body").css("class",".caveskarsts");c.animate({scrollTop:$('.slide[data-slide="'+a+'"]').offset().top-b},2e3,"easeInOutQuint")},a.buttonClick=function(b){b.preventDefault();var c=angular.element(b.target).attr("data-slide");a.goToByScroll(c)}}]),angular.module("aquiferiumApp").controller("ConservationCtrl",["$scope","$location","$anchorScroll",function(a,b,c){a.pageClass="conservation",a.resetView=function(){b.hash(".conservation"),c()},a.resetView(),a.goToByScroll=function(a){var b=$("#navbar").innerHeight(),c=angular.element(document).find("body").css("class",".conservation");c.animate({scrollTop:$('.slide[data-slide="'+a+'"]').offset().top-b},2e3,"easeInOutQuint")},a.buttonClick=function(b){b.preventDefault();var c=angular.element(b.target).attr("data-slide");a.goToByScroll(c)}}]),angular.module("aquiferiumApp").controller("SpringsCtrl",["$window","$scope","$location","$anchorScroll",function(a,b,c,d){b.pageClass="springs",b.hcpurl="http://eahcp.org/index.php/about_eahcp/covered_species",b.linkModelFunc=function(b){a.open(b)},b.resetView=function(){c.hash(".springs"),d()},b.resetView(),b.goToByScroll=function(a){var b=$("#navbar").innerHeight(),c=angular.element(document).find("body").css("class",".springs");c.animate({scrollTop:$('.slide[data-slide="'+a+'"]').offset().top-b},2e3,"easeInOutQuint")},b.buttonClick=function(a){a.preventDefault();var c=angular.element(a.target).attr("data-slide");b.goToByScroll(c)}}]),angular.module("aquiferiumApp").controller("AboutCtrl",["$scope",function(a){a.pageClass="about",a.code="SUhtSnl_ZRM"}]),angular.module("aquiferiumApp").controller("ContactCtrl",["$scope",function(a){a.pageClass="contact"}]),angular.module("app.directives.d3.maps",[]).directive("eaaAquifersMap",[function(){var a={compile:!1,controller:function(a){console.log("controller for:",a.pageClass)},controllerAs:!1,link:!1,priority:0,require:!1,restrict:"E",scope:!1,template:!1,templateUrl:!1,terminal:!1,transclude:!1,type:!1};return a.link=function(a,b){function c(){var a="#"+("00000"+(Math.random()*(1<<24)|0).toString(16)).slice(-6);return a}function d(a){return B=d3.select(this),"hidden"===E.style("visibility")?(B.moveToFront().transition().duration(z).attr("r",y).style("stroke-width","3px").style("stroke","#ff0"),A=a,C=B,E.style("visibility","visible").html("<h2>"+a.Location+'</h2><br/><img src="'+(r+a.img)+'" alt="" /><br/><a href="../">Explore</a>')):"visible"===E.style("visibility")&&a!==A?(C.moveToBack().transition().duration(z).attr("r",x).style("stroke-width","1px").style("stroke","#000"),B.moveToFront().transition().duration(z).attr("r",y).style("stroke-width","3px").style("stroke","#ff0"),A=a,C=B,E.style("visibility","visible").html("<h2>"+a.Location+'</h2><br/><img src="'+(r+a.img)+'" alt="" /><br/><a href="../">Explore</a>')):(B.transition().duration(z).attr("r",x).style("stroke-width","1px").style("stroke","#000"),A={},C={},B={},E.style("visibility","hidden"))}var e=window,f=document,g=f.documentElement,h=f.getElementsByTagName("body")[0],i=e.innerWidth||g.clientWidth||h.clientWidth,j=e.innerHeight||g.clientHeight||h.clientHeight;console.log(i+" Ã— "+j),console.log(window.screen.availWidth,window.screen.availHeight);var k=.9,l=.6,m=i*k,n=j*l;console.log(m,n);var o="./data/geojson/NEW_major_aquifers_dd_reduced100.geo.json",p="./data/geojson/eaa_boundary_EPSG-3081.geo.json",q="./data/eaaAquiferium-allSprings-markerData.csv",r="../../images/d3map/",s={top:10,right:10,bottom:10,left:10},t=m-s.left-s.right,u=n-s.top-s.bottom,v=[t/2,u/2],w=4*u,x=5,y=20,z=250,A={},B={},C={},D=b[0],E=d3.select(D).append("div").attr("class","tooltip"),F=(d3.select(D).append("div").attr("class","map"),d3.select(".map").append("svg").attr("width",t).attr("height",u).attr("class","mapSvg")),G=F.append("g").attr("class","texas"),H=F.append("g").attr("class","boundaries");d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},d3.selection.prototype.moveToBack=function(){return this.each(function(){var a=this.parentNode.firstChild;a&&this.parentNode.insertBefore(this,a)})},d3.json(o,function(a,b){if(a)return console.error(a);var e=w,f=v,g=d3.geo.centroid(b),h=d3.geo.mercator().scale(e).center(g).translate(f),i=d3.geo.path().projection(h),j=G.selectAll("g").data(b.features).enter().append("g");j.append("path").attr("d",i).attr("class","area").attr("fill","#425968").attr("stroke","#4298B5"),d3.json(p,function(a,b){if(a)return console.error(a);var e=H.selectAll("g").data(b.features).enter().append("g");e.append("path").attr("d",i).attr("class","area").attr("fill","#8F8100").attr("stroke","#000");var f=e.append("g");d3.csv(q,function(a,b){return a?console.error(a):void f.selectAll("circle").data(b).enter().append("circle").attr("cx",function(a){return h([a.lon_ddd,a.lat_ddd])[0]}).attr("cy",function(a){return h([a.lon_ddd,a.lat_ddd])[1]}).attr("r",x).attr("z-index",0).style("fill",function(){return c()}).style("stroke","#000").on("click",d)})})})},console.log("directiveDefinitionObject: ",a),a}]),angular.module("app.directives.d3.interactives",[]).directive("eaaGaugeDataInteractiveSprings",[function(){var a={compile:!1,controller:function(){},controllerAs:!1,link:!1,priority:0,require:!1,restrict:"E",scope:!1,template:!1,templateUrl:!1,terminal:!1,transclude:!1,type:!1};return a.link=function(a,b){function c(){this.parentNode.parentNode.appendChild(this.parentNode),d3.select(this).style("stroke-width","6px")}function d(){d3.select(this).style("stroke-width","2px")}function e(a){console.log(d3.select(a)[0][0].Location)}var f=window,g=document,h=g.documentElement,i=g.getElementsByTagName("body")[0],j=f.innerWidth||h.clientWidth||i.clientWidth,k=f.innerHeight||h.clientHeight||i.clientHeight,l=.965,m=.65,n=j*l,o=k*m,p="./data/geojson/eaa_boundary_EPSG-3081.geo.json",q="./data/eaaAquiferium-allSprings-markerData.csv",r="./data/eaaAquiferium-allSpringsData-annualAvg-byDate.csv",s={top:20,right:0,bottom:20,left:0},t=n-s.left-s.right,u=o-s.top-s.bottom,v=.9*t,w=.4*u,x=.8*t,y=.6*u;console.log(s,t,u,v,w,x,y);var z=5,A=d3.scale.category10().domain(["Barton Springs","Comal Springs","Hueco Springs","J17","J27","Las Moras Springs","Leona Springs","San Antonio Springs","San Marcos Springs","San Pedro Springs"]),B=d3.scale.ordinal(),C=d3.time.format("%Y"),D=d3.time.scale().range([0,x-20]),E=d3.scale.linear().range([y-20,0]),F=d3.svg.axis().scale(D).orient("bottom").ticks(20),G=d3.svg.axis().scale(E).orient("left").ticks(20),H=b[0],I=(d3.select(H).append("div").attr("class","viz").attr("width",t).attr("height",u),d3.select(".viz").append("div").attr("class","map"),d3.select(".map").append("svg").attr("class","mapSvg").attr("height",w)),J=I.append("g").attr("class","eaabounds");J.attr("transform","translate(100,20)");var K=(d3.select(".viz").append("div").attr("class","chart"),d3.select(".chart").append("svg").attr("class","chartSvg").attr("height",y)),L=K.append("g").attr("class","graphbounds");L.attr("transform","translate(0,0)");var M=d3.svg.line().interpolate("monotone").x(function(a){return D(a.date)}).y(function(a){return E(a.gindex)}).defined(function(a){return a.gindex});d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},d3.selection.prototype.moveToBack=function(){return this.each(function(){var a=this.parentNode.firstChild;a&&this.parentNode.insertBefore(this,a)})},d3.json(p,function(a,b){if(a)return console.error(a);var c=28*w,d=[v/2,w/2],f=d3.geo.centroid(b),g=d3.geo.mercator().scale(c).center(f).translate(d),h=d3.geo.path().projection(g),i=J.selectAll("g").data(b.features).enter().append("g");i.append("path").attr("d",h).attr("class","area").attr("fill","#8F8100").attr("stroke","#000");var j=i.append("g");d3.csv(q,function(a,b){return a?console.error(a):void j.selectAll("circle").data(b).enter().append("circle").attr("class",function(a){return a.Location}).attr("cx",function(a){return g([a.lon_ddd,a.lat_ddd])[0]}).attr("cy",function(a){return g([a.lon_ddd,a.lat_ddd])[1]}).attr("r",z).attr("z-index",0).style("fill",function(a){return A(a.Location)}).style("stroke","#000").on("click",e)})}),d3.csv(r,function(a,b){b.forEach(function(a){a.Date=C.parse(a.Date),a["Barton Springs"]=+a["Barton Springs"],a["Comal Springs"]=+a["Comal Springs"],a["Hueco Springs"]=+a["Hueco Springs"],a.J17=+a.J17,a.J27=+a.J27,a["Las Moras Springs"]=+a["Las Moras Springs"],a["Leona Springs"]=+a["Leona Springs"],a["San Antonio Springs"]=+a["San Antonio Springs"],a["San Marcos Springs"]=+a["San Marcos Springs"],a["San Pedro Springs"]=+a["San Pedro Springs"]}),B.domain(d3.keys(b[0]).filter(function(a){return"Date"!==a}));var e=B.domain().map(function(a){return{name:a,values:b.map(function(b){return{date:b.Date,gindex:+b[a]}})}});D.domain(d3.extent(b,function(a){return a.Date})),E.domain([d3.min(e,function(a){return d3.min(a.values,function(a){return a.gindex})}),d3.max(e,function(a){return d3.max(a.values,function(a){return a.gindex})})]),L.append("g").attr("class","x axis").attr("transform","translate(0,"+(y-20)+")").call(F),L.append("g").attr("class","y axis").call(G).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("gauge level in cfs");var f=L.selectAll(".gauge").data(e).enter().append("g").attr("class",function(a){return a.name});f.append("path").attr("class","line").attr("d",function(a){return M(a.values)}).style("stroke",function(a){return A(a.name)}).on("mouseover",c).on("mouseout",d).attr("id",function(a){return a.name});var g=f.filter(function(){}).selectAll("circle").data(function(a){return a.values}).enter().append("circle").attr({cx:function(a){return D(a.date)},cy:function(a){return E(a.gindex)},r:2}).style("fill","#555");g.on("mouseover",function(a){g.append("text").attr({x:function(){return D(a.date)},y:function(){return E(a.gindex)},dx:-3,dy:".35em","text-anchor":"end"}).style("fill","black").text(function(){var b=d3.time.format("%d-%B-%Y");return"Date:"+b(a.date)+",index:"+a.gindex})}).on("mouseout",function(){d3.select(this.parentElement).selectAll("text").remove()});var h=L.selectAll(".svg").data(e).enter().append("g").attr("class","legend").attr("transform","translate(-240,0)");h.append("rect").attr("x",t+20).attr("y",function(a,b){return 20*b}).attr("width",10).attr("height",10).style("fill",function(a){return A(a.name)}),h.append("text").attr("x",t+34).attr("y",function(a,b){return 20*b+9}).text(function(a){return a.name}).attr("color","#000").attr("class",function(a){return a.name})})},a}]);